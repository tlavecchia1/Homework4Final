// spotify-7436afc376.min.js, revision: 9e8549f, timestamp: 2015-12-22 00:41:13 +0000
var tumra_config=tumra_config||{"ClientID":"ce6439f9da","SiteID":"9fcce43349","cookieDomain":".spotify.com","campaigns":[]};(function(){if(document.location.hostname==="www.spotify.com"){tumra_config["SiteID"]="7436afc376";}else{if(document.location.hostname==="play.spotify.com"){tumra_config["SiteID"]="20fc24452c";}else{if(document.location.hostname==="open.spotify.com"){tumra_config["SiteID"]="87c380ccf7";}else{if(document.location.hostname==="support.spotify.com"){tumra_config["SiteID"]="d2437b42ef";}}}}if(document.location.pathname.indexOf("/purchase/product/")>-1){if(typeof jQuery!=="undefined"){window._tumra_custom_vars={};var fields=["offer-country","offer-country-product-id"];for(var i=0;i<fields.length;i++){var field=fields[i];var element=jQuery(".payment-provider:visible input[name="+field+"]");if(element.length>0){var value=jQuery(element[0]).val();window._tumra_custom_vars[field]=value;}}}}if(document.location.pathname.indexOf("/purchase/panel/")>-1){if(typeof jQuery!=="undefined"){window._tumra_custom_vars={};var fields=["offer-country","offer-country-product-id"];for(var i=0;i<fields.length;i++){var field=fields[i];var element=jQuery(".payment-provider:visible input[name="+field+"]");if(element.length>0){var value=jQuery(element[0]).val();window._tumra_custom_vars[field]=value;}}}}}());var tumra=tumra||{};(function(){var session="",pollInterval=undefined,errors=0,queue=[];tumra.debug={};tumra.debug.log_messages=[];tumra.debug.time_loaded=new Date().getTime();tumra.optimizeEnabled=false;tumra.isControl=null;tumra.ready=false;tumra.campaign=null;var defaultConfig={"sessionCookieTimeout":1800,"campaignCookieTimeout":60*86400,"deviceCookieTimeout":180*86400,"identifyCookieTimeout":365*86400,"endpointHost":"api.tumra.com","alwaysUseSSL":false,"useSSL":"https:"===document.location.protocol,"useWebSockets":false,"useAjax":true,"usePixel":true,"debugEnabled":false,"pollInterval":250,"defaultTimeout":5000,"campaigns":[]};var config=typeof tumra_config!=="undefined"?tumra_config:{};for(var k in defaultConfig){if(defaultConfig.hasOwnProperty(k)){if(typeof config[k]==="undefined"){config[k]=defaultConfig[k];}}}for(var key in config){var val=getCookie("__tumra_"+key);if(val!==null){if(typeof config[key]==="boolean"){config[key]=val==="true"?true:false;}else{if(typeof config[key]==="number"){config[key]=parseInt(val);}else{config[key]=val;}}}}config.wsURI=(config.useSSL||config.alwaysUseSSL?"wss://":"ws://")+config.endpointHost+"/ws";config.ajaxURI=(config.useSSL||config.alwaysUseSSL?"https://":"http://")+config.endpointHost+"/v1";config.pixelURI=(config.useSSL||config.alwaysUseSSL?"https://":"http://")+config.endpointHost+"/t.gif";config.campaignURI=(config.useSSL||config.alwaysUseSSL?"https://":"http://")+config.endpointHost+"/c";config.hasWebSockets=typeof(WebSocket)!=="undefined";config.hasAjax=createCORSRequest("POST",config.ajaxURI)!==null;config.hasStorage=typeof(Storage)!=="undefined";config.hasConsole=typeof console!=="undefined";var debug=getQueryParameter("_tumra_debug");if(debug==="true"){config["debugEnabled"]=true;setCookie("__tumra_debugEnabled","true",30*86400);}else{if(debug==="false"){config["debugEnabled"]=false;setCookie("__tumra_debugEnabled","false",30*86400);}}var log=tumra.log=function(message){var delta=new Date().getTime()-tumra.debug.time_loaded;if(typeof message==="object"&&typeof JSON!=="undefined"){message=JSON.stringify(message);}tumra.debug.log_messages.push("+"+delta+" - "+message);if(config.debugEnabled&&config.hasConsole){console.log("[TUMRA] +"+delta+" - "+message);}};tumra.buildPageViewMeta=function(){var meta={url:window.location.href,referrer:document.referrer};if(getCookie("__utma")!==null){meta["__utma"]=getCookie("__utma");meta["__utmb"]=getCookie("__utmb");meta["__utmc"]=getCookie("__utmc");meta["__utmz"]=getCookie("__utmz");}if(getCookie("__tums")){var identity=getCookie("__tums");if(identity.length>0){config.Identity=identity;}}if(typeof window._tumra_custom_vars!=="undefined"){for(var k in window._tumra_custom_vars){if(window._tumra_custom_vars.hasOwnProperty(k)){meta[k]=window._tumra_custom_vars[k];}}}return meta;};tumra.identify=function(identity,properties){if(typeof identity==="undefined"){return;}var obj=properties||{};obj.username=identity;var request={"cid":config["ClientID"],"id":identity.trim().toLowerCase(),"p":obj};if(config.hasAjax){try{var postData=JSON.stringify(request);var xhr=createCORSRequest("POST","https://"+config.endpointHost+"/1/identify");xhr.onload=function(){tumra.log(xhr);};xhr.onerror=function(){tumra.log(xhr);};xhr.onreadystatechange=function(){if(xhr.readyState!=4){return;}if(xhr.status==200||xhr.status==304){var response=JSON.parse(xhr.responseText);if(response["status"]==="ok"){var id=response["id"];if(id!=getCookie("__tums")||id!=getCookie("__tumi")){setCookie("__tums",id);setCookie("__tumi",id,config.identifyCookieTimeout);config.Identity=id;tumra.event("Identify",obj);tumra.event("PageView",tumra.buildPageViewMeta());}}else{tumra.log(xhr.responseText);}}};xhr.setRequestHeader("Content-Type","application/json");xhr.send(postData);}catch(err){tumra.log(err);}}else{tumra.event("Identify_NoAjax",request);tumra.event("Identify",obj);}};tumra.event=function(a,b){var type;var obj;if(typeof a==="string"){type=a;obj=b;}else{type="undefined";obj=a;}if(obj.nodeType){obj=elementToObject(obj);}if(getCookie("__tumi")){obj["identity"]=getCookie("__tumi");}if(typeof window._tumra_custom_vars==="object"){for(var key in window._tumra_custom_vars){obj[key]=window._tumra_custom_vars[key];}}tumra.log("event() - type: "+type+", obj: "+JSON.stringify(obj));tumra.enqueue(type,obj);};tumra.e=tumra.event;tumra.push=function(array){if(typeof array==="undefined"){return;}if(array.length==0){return;}var type=array.shift();if(type.indexOf("_add")===0){tumra.ga_obj=tumra.ga_obj||{};if(typeof tumra.ga_obj[type]==="undefined"){tumra.ga_obj[type]=[];}tumra.ga_obj[type].push(array);}else{if(type.indexOf("_track")===0){tumra.ga_obj=tumra.ga_obj||{};tumra.event(type,tumra.ga_obj);tumra.ga_obj={};}}};tumra.post=function(type,obj){try{var event={"e":type,"d":obj};var postData=JSON.stringify(event);var xhr=createCORSRequest("POST",config.ajaxURI);xhr.onload=function(){log(xhr);};xhr.onerror=function(){log(xhr);};xhr.setRequestHeader("Content-Type","application/json");xhr.send(postData);}catch(err){tumra.log(err);}};tumra.enqueue=function(a,b){var event={"e":a,"d":b};if(typeof config["ClientID"]!=="undefined"){event["cid"]=config["ClientID"];}if(typeof config["SiteID"]!=="undefined"){event["sid"]=config["SiteID"];}if(typeof config["Identity"]!=="undefined"){event["ident"]=config["Identity"];}queue.push(event);};tumra.flush=function(){flush();};tumra.abort=function(){backoff();};tumra.finished=function(from){tumra.log("finished: "+from);tumra.campaign.finished=true;if(tumra.campaign.timeout){clearTimeout(tumra.campaign.timeout);}if(tumra.campaign.after){tumra.log("   ... after: "+tumra.campaign.after);try{eval(tumra.campaign.after);}catch(e){tumra.log("ERROR: "+e.name+" "+e.message);}}tumra.campaign.time_finish=new Date().getTime();tumra.campaign.time_total=tumra.campaign.time_finish-tumra.campaign.time_start;};function init(){if(getCookie("_tumra_disabled")!==null||getCookie("_tumra_opt_out")!==null){return;}if(config.sample){var sample=getCookie("__ts");if(!sample){sample=Math.random();setCookie("__ts",sample,null);}if(sample>config.sample){return;}}var tumraID=getCookie("__tdev");if(!tumraID){tumraID=generateRandomID();}setCookie("__tdev",tumraID,config.deviceCookieTimeout);var newVisit=false;var tumraSession=getCookie("__tvis");if(!tumraSession){newVisit=true;tumraSession=generateRandomID();}setCookie("__tvis",tumraSession,config.sessionCookieTimeout);session=tumraID+tumraSession;pollInterval=setInterval(poll,config.pollInterval);var meta=tumra.buildPageViewMeta();if(newVisit){if(getCookie("__tumi")){meta["identity"]=getCookie("__tumi");}tumra.event("Visit",meta);}tumra.event("PageView",meta);var tume=getQueryParameter("_tume");if(typeof tume!=="undefined"){try{var obj=JSON.parse(atob(tume));if(typeof obj==="object"){var event=obj.e||"Event";var data=obj.d||{};for(var k in data){meta[k]=data[k];}tumra.event(event,meta);}}catch(ignore){}}}var query_string=undefined;function getQueryParameter(name){if(typeof query_string==="undefined"){query_string={};var array=window.location.search.substr(1).split("&");for(var i=0;i<array.length;i++){var parts=array[i].split("=");if(parts.length!=2){continue;}query_string[parts[0]]=decodeURIComponent(parts[1].replace(/\+/g," "));}}return query_string[name];}function flush(){var obj;var objs=[];while((obj=queue.shift())!==undefined){objs.push(obj);}if(config.useWebSockets&&config.hasWebSockets){}else{if(config.useAjax&&config.hasAjax){var postData="",pendingEvents=[];while((obj=objs.shift())!==undefined){if(typeof obj.session==="undefined"){obj.session=session;}if(typeof obj.timestamp==="undefined"){obj.timestamp=new Date().getTime();}postData+=JSON.stringify(obj)+"\n";pendingEvents.push(obj);}try{var xhr=createCORSRequest("POST",config.ajaxURI);xhr.onload=function(){if(xhr.responseText!=='{"status":"ok"}'){while((obj=pendingEvents.shift())!==undefined){queue.push(obj);}tumra.abort();return;}backoffReset();};xhr.onerror=function(){while((obj=pendingEvents.shift())!==undefined){queue.push(obj);}tumra.abort();};if(typeof xhr.setRequestHeader==="function"){xhr.setRequestHeader("Content-Type","application/json");}xhr.send(postData);}catch(err){tumra.log(err);}}else{if(config.usePixel&&typeof window.btoa==="function"){while((obj=objs.shift())!==undefined){obj.session=session;obj.timestamp=new Date().getTime();try{var json=JSON.stringify(obj);var payload=btoa(json);var image=new Image();image.obj=obj;image.onload=function(){backoffReset();};image.onerror=image.onabort=function(e){queue.push(this.obj);tumra.abort();};image.src=config.pixelURI+"?"+payload;}catch(e){tumra.log("ERROR: "+e.name+" "+e.message);}}}else{log("   ... uh oh, no method for sending events is defined!");}}}}function poll(){if(queue.length>0){tumra.flush();}}function backoff(){var wait=config.pollInterval+(config.pollInterval*(errors*errors));if(wait>45000){wait=45000;}errors+=1;clearInterval(pollInterval);pollInterval=setInterval(poll,wait);}function backoffReset(){errors=0;clearInterval(pollInterval);pollInterval=setInterval(poll,config.pollInterval);}function elementToObject(el,o){var obj=o||{};obj.tagName=el.tagName;for(var i=0;i<el.attributes.length;i++){obj[el.attributes[i].name]=el.attributes[i].value;}return obj;}function generateRandomID(){var i,id=[],chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),radix=chars.length;for(i=0;i<8;i++){id[i]=chars[0|Math.random()*radix];}return id.join("");}function getCookie(name){var i,x,y,cookies=document.cookie.split(";");for(i=0;i<cookies.length;i++){x=cookies[i].substr(0,cookies[i].indexOf("="));y=cookies[i].substr(cookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x===name){return unescape(y);}}return null;}function setCookie(name,value,seconds){value=escape(value)+"; path=/";if(seconds){var date=new Date();date.setTime(date.getTime()+(seconds*1000));value+="; expires="+date.toUTCString();}if(config.cookieDomain){value+="; domain="+config.cookieDomain;}document.cookie=name+"="+value;}function createCORSRequest(method,url){if(typeof XMLHttpRequest==="undefined"){return null;}var xhr=new XMLHttpRequest();if("withCredentials" in xhr){xhr.open(method,url,true);}else{if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest();xhr.open(method,url);}else{xhr=null;}}return xhr;}if(typeof(btoa)!=="function"){tumra.log("btoa: native implementation not available, adding our own");window.btoa=function(g){var q,m,k,p,l,j,h,d="",e=0,o="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";g=g.replace(/\r\n/g,"\n");for(var a=0;a<g.length;a++){var f=g.charCodeAt(a);if(f<128){o+=String.fromCharCode(f);}else{if((f>127)&&(f<2048)){o+=String.fromCharCode((f>>6)|192);o+=String.fromCharCode((f&63)|128);}else{o+=String.fromCharCode((f>>12)|224);o+=String.fromCharCode(((f>>6)&63)|128);o+=String.fromCharCode((f&63)|128);}}}g=o;while(e<g.length){q=g.charCodeAt(e++);m=g.charCodeAt(e++);k=g.charCodeAt(e++);p=q>>2;l=((q&3)<<4)|(m>>4);j=((m&15)<<2)|(k>>6);h=k&63;if(isNaN(m)){j=h=64;}else{if(isNaN(k)){h=64;}}d=d+b.charAt(p)+b.charAt(l)+b.charAt(j)+b.charAt(h);}return d;};}if(typeof(JSON)!=="object"){tumra.log("JSON: native implementation not available, adding our own");window.JSON={};(function(){function f(n){return n<10?"0"+n:n;}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(var k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}}());}init();}());(function(){function getCookie(name){var i,x,y,cookies=document.cookie.split(";");for(i=0;i<cookies.length;i++){x=cookies[i].substr(0,cookies[i].indexOf("="));y=cookies[i].substr(cookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x===name){return unescape(y);}}return null;}var spot={};var spot_cookie=getCookie("spot");if(spot_cookie){try{spot=JSON.parse(getCookie("spot"));if(spot.p){spot.product=spot.p;}if(spot.m){spot.market=spot.m;}}catch(ignore){}}var userinfo=getCookie("sp_userinfo");if(userinfo){try{var obj=JSON.parse(getCookie("sp_userinfo"));if(typeof obj.username!=="undefined"){tumra.identify(obj.username,obj);}}catch(ignore){}}if(jQuery("img.avatar-img[src*=facebook]").length>0){try{var email=jQuery("#pbody .table-wrapper tr:eq(2) td:eq(1)").first().text();var displayName=jQuery("img.avatar-img[src*=facebook]").first().attr("alt");var facebookId=jQuery("img.avatar-img[src*=facebook]").first().attr("src").replace("https://graph.facebook.com/","").replace("/picture","");if(username.length>0){var obj=spot;obj.username=facebookId;obj.email=email;obj.displayName=displayName;obj.facebookId=facebookId;tumra.identify(username,obj);}}catch(ignore){}}else{if(document.location.pathname.indexOf("/login/")>-1){jQuery("#login-username").on("change",function(){var username=jQuery(this).val();var obj=spot;obj.username=username;tumra.identify(username,obj);});}else{if(document.location.pathname.indexOf("/account/profile/")>-1){try{var username=jQuery("#js-account img[alt]").attr("alt");var email=jQuery("#profile_email").val();if(username.length>0&&email.length>0){var obj=spot;obj.username=username;obj.email=email;tumra.identify(username,obj);}}catch(ignore){}}else{if(document.location.pathname.indexOf("/account/overview/")>-1){try{var username=jQuery("#card-profile-username").text();var email=jQuery("#card-profile-email").text();if(username.length>0&&email.length>0){var obj=spot;obj.username=username;obj.email=email;tumra.identify(username,obj);}}catch(ignore){}}else{if((document.referrer.indexOf("accounts.spotify.com")>-1)||(document.location.pathname.indexOf("/purchase/panel/")>-1)){try{var username=jQuery("#navbar-nav > ul > li.dropdown.alternate.hidden-sidepanel > a > span").text();if(username.length>0){var obj=spot;obj.username=username;tumra.identify(username,obj);}}catch(ignore){}}else{try{if(document.getElementById("logout-notice")){var notice=document.getElementById("logout-notice");if(notice.getElementsByTagName("strong")){var userId=notice.getElementsByTagName("strong")[0].innerHTML;tumra.identify(userId,{});}}}catch(ignore){}}}}}}if(typeof jQuery!=="undefined"){(function($){$(document).ready(function(){if(Math.random()<0.005){var scrollDistancePercentMax=0;var scrolledPastFold=false;var scrolledToEnd=false;$(document).scroll(function(e){var winHeight=$(window).height();var docHeight=$(document).height();var scrollTop=$(document).scrollTop();var scrollDistancePercent=Math.floor(((scrollTop+(winHeight/2))/docHeight)*10)*10;if(scrollDistancePercent>scrollDistancePercentMax){tumra.event("Window",{"type":"Scroll","percent":scrollDistancePercent,"windowHeight":winHeight,"documentHeight":docHeight,"scrollTop":scrollTop,"url":document.location.href});scrollDistancePercentMax=scrollDistancePercent;}if(scrollTop>winHeight&&scrolledPastFold===false){tumra.event("Window",{"type":"ScrollPastFold","windowHeight":winHeight,"documentHeight":docHeight,"scrollTop":scrollTop,"url":document.location.href});scrolledPastFold=true;}if((scrollTop+winHeight)>(docHeight-50)&&scrolledToEnd===false){tumra.event("Window",{"type":"ScrollToEnd","windowHeight":winHeight,"documentHeight":docHeight,"scrollTop":scrollTop,"url":document.location.href});scrolledToEnd=true;}});}});}(jQuery));}}());